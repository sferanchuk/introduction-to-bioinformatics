#!/usr/bin/python
# -*- coding: utf-8 -*-


import numpy as np
import matplotlib
from matplotlib import gridspec
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import math
import scipy.stats as stats

sponge_abund = {
"dis-L-r1" : [ 135,16,0,76,67,0,110,5,1,0,0,4,0,0,107,0,35,0,0,0,3,0,88,0,0,5,24,3,0,9,5,0,1,1,0,0,0,1,0,0,0,0,0,0,2,0,14,0,0,0,10,0,2,2,2,17,187,0,0,0,7,0,0,10,0,0,468,0,2,0,0,0,0,36,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,5,0,5,0,0,0,0,0,0,0,0,0,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,25,0,0,0,0,2,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0],
"dis-L-r2" : [ 70,6,0,164,12,0,46,18,15,0,0,3,0,0,88,0,232,0,0,0,2,0,99,2,0,5,71,3,0,19,14,0,0,6,0,0,0,0,0,0,0,0,0,3,0,0,1,0,0,0,2,0,0,0,0,25,76,0,0,0,3,0,0,3,0,1,965,2,3,0,0,0,0,17,0,0,0,0,0,0,0,0,1,2,6,7,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1 ],
"dis-L-r3" : [ 71,30,0,24,5,0,149,7,16,1,2,0,0,0,73,0,105,2,0,0,11,0,39,0,0,42,13,7,0,0,3,4,0,8,0,1,0,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,1,0,0,10,25,0,0,2,34,0,0,4,0,5,1073,1,4,10,0,0,0,24,2,0,0,0,0,0,0,0,1,0,0,7,0,0,0,9,0,1,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,0,6,2,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,53,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0],
"dis-OV-r1" : [ 127,0,0,23,2,15,15,1,2,8,0,0,0,0,184,0,20,0,0,0,79,39,29,0,0,4,55,0,2,0,18,0,1,5,0,0,0,0,0,0,2,0,1,1,0,3,0,0,0,0,1,0,0,1,0,12,2,0,0,0,5,0,0,6,3,0,1824,4,2,0,0,7,0,1,0,3,0,0,1,0,0,0,1,0,0,40,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,237,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,0,0],
"dis-OV-r2" : [ 77,0,0,16,23,0,0,0,45,0,0,1,1,0,153,0,332,0,0,0,9,0,31,0,0,30,2,1,0,129,177,0,0,272,0,0,0,0,0,0,0,0,0,1,0,0,10,0,1,0,3,0,1,0,0,5,2,0,0,0,9,0,0,0,0,0,34,0,2,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
"dis-OV-r3" : [ 98,0,0,30,127,0,6,0,38,0,0,0,0,0,95,0,126,0,1,0,0,0,32,0,0,0,19,0,0,97,174,0,0,11,0,0,0,0,1,0,0,0,0,8,0,0,2,0,0,0,2,0,1,0,0,2,10,0,0,0,5,0,0,15,0,1,89,0,1,0,0,1,0,7,0,0,0,0,0,0,0,0,0,4,1,32,0,0,0,2,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,4,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,0,0],
"dis-OV-r4" : [ 856,0,0,345,15,1,77,12,38,0,1,0,0,0,332,0,91,1,2,0,25,0,216,7,1,27,129,1,0,3,4,0,2,0,0,0,0,0,0,1,0,0,0,6,2,0,0,0,0,0,0,0,0,0,0,38,249,0,0,0,10,0,0,41,0,0,206,49,3,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,1,51,0,0,0,11,0,2,1,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,16,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,23,0,0],
"dis-T-r1" : [ 174,6,3,15,3,0,64,24,109,19,0,0,2,0,217,0,673,8,0,0,17,9,80,0,5,5,65,0,0,6,0,0,0,2,0,0,1,0,0,0,1,0,3,0,0,2,0,0,2,0,4,0,1,3,0,4,41,0,0,1,1,0,0,3,1,0,2845,3,4,0,0,4,0,2,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,11,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,30,0,2,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,0,2,0,0,0,0,6,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,5],
"dis-T-r2" : [ 658,2,4,5,28,2,4,0,33,172,0,0,0,4,69,0,237,0,0,0,137,26,14,0,0,0,17,2,1,7,154,0,1,58,3,0,2,0,0,4,23,1,0,18,0,3,1,0,1,0,0,1,0,1,0,4,5,2,1,5,15,3,2,5,0,0,242,7,7,1,0,0,0,5,0,16,0,0,0,0,2,0,0,3,3,47,1,0,0,3,0,1,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,4,0,1,0,0,5,0,0,1,0,0,1,0,0,0,1,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,1,0,1,0,0,0,0,2,0,0,0,0,0,0,0,83,0,2],
"dis-T-r3" : [ 339,0,1,414,918,0,3,0,327,2,0,0,1,0,52,0,137,0,0,0,1,3,46,0,0,32,8,0,0,103,234,0,0,44,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,133,0,3,6,4,0,0,1,0,0,6,4,2,0,0,0,0,0,0,0,0,0,0,0,1,0,0,15,0,5,0,0,0,12,0,0,0,0,0,0,0,0,0,1,0,3,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,68,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
"dis-T-r4" : [ 416,7,9,335,94,4,44,14,87,35,0,0,0,0,432,0,134,0,0,0,3,8,265,2,3,121,118,0,0,33,118,0,0,2,0,0,0,0,0,2,0,9,0,13,0,3,0,0,12,3,8,0,1,3,0,10,174,0,10,16,51,4,0,79,0,4,286,38,11,6,0,1,1,10,4,3,16,0,2,1,3,1,0,3,2,12,0,0,0,35,6,0,2,0,1,0,3,5,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,0,0,0,5,0,0,2,0,0,5,1,0,0,0,2,9,0,0,0,0,0,3,0,0,0,0,16,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,6,0,0,1,0,0,0,2,0,0,0,0,5,0,0,0,0,0,1,0,41,0,0,0,0,0,0,0,1,0,7,0,0,0,0,0,0,0,0,0,0,21,0,10],
"healthy-L-r1" : [ 1612,1,0,0,2,0,30,0,5,1,0,0,1,2,240,0,15,1,0,0,195,2,2,0,0,0,5,0,0,0,10,0,1,2,6,0,1,0,0,0,2,1,4,1,0,0,0,0,0,0,4,0,0,0,0,55,1,0,0,0,4,0,2,0,2,0,1688,0,20,1,0,2,0,0,0,9,0,0,0,0,4,0,0,0,0,144,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0,0,0,18,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],
"healthy-L-r2" : [ 196,0,1,0,0,0,3,0,0,0,0,0,0,0,13,0,0,0,0,0,66,6,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,0,0,0,1,0,0,0,0,5,1,0,0,0,2,0,0,0,0,2,5,0,0,0,0,0,0,0,4,0,4234,0,0,0,0,1,0,6,0,5,0,0,0,0,1,0,0,0,0,17,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
"healthy-L-r3" : [ 1808,2,1,0,5,2,7,0,1,0,0,1,3,2,42,0,11,1,2,0,103,11,0,0,0,0,0,6,0,0,4,0,0,12,1,0,8,0,0,0,11,0,0,0,1,2,0,0,0,0,0,0,0,0,0,14,0,0,0,0,0,0,0,0,1,0,2623,0,4,0,0,2,0,2,0,12,0,0,1,0,1,0,0,0,0,45,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,4,0,0,0,0,0,0,0,0,2,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,3,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,10,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
"healthy-L-r4" : [ 1685,1,0,3,0,3,1,0,0,0,0,0,1,3,85,0,9,1,0,0,154,17,0,0,0,0,0,0,0,0,1,2,0,21,4,0,6,0,0,0,16,0,0,0,0,2,0,1,0,0,0,0,0,0,0,19,0,0,0,0,0,0,0,0,0,0,504,0,6,0,0,0,0,0,0,4,0,0,0,0,1,0,0,0,0,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],
"healthy-L-r5" : [ 2277,0,0,3,0,2,1,0,1,0,0,0,0,0,84,0,38,0,0,0,196,6,1,0,0,0,0,0,0,0,3,0,1,10,0,0,2,0,0,0,7,0,0,0,0,2,0,0,3,0,0,0,0,0,0,19,0,0,0,0,1,0,0,0,3,0,1230,1,6,0,0,2,0,1,0,9,0,0,0,0,3,0,0,0,0,145,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
"healthy-OV-r1" : [ 222,0,1,26,3,9,59,0,0,11,0,0,0,0,24,0,14,0,0,0,165,79,1,0,0,0,67,0,3,0,7,0,0,9,4,0,0,0,0,0,11,0,6,0,0,0,1,0,0,0,4,0,1,1,0,65,5,0,0,0,2,0,0,0,12,0,2798,0,2,0,0,13,0,0,0,7,0,0,3,0,0,0,0,0,0,140,2,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,5,0,0,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
"healthy-OV-r2" : [829,1,0,16,0,5,30,0,2,3,0,1,0,0,46,0,39,1,0,0,29,57,3,0,0,0,23,3,6,0,31,0,0,7,3,0,0,0,0,0,21,0,0,0,0,4,2,0,0,0,0,0,0,1,0,22,0,0,0,0,0,0,0,0,2,0,890,0,3,0,0,6,0,18,0,33,0,0,0,0,0,0,0,0,0,94,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,4,0,0,2,0,0,0,0,0,0,0,4,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
"healthy-OV-r3" : [ 1336,0,0,4,1,4,0,0,11,4,0,0,0,0,39,0,29,1,0,0,131,33,4,0,1,0,21,0,4,0,23,0,0,6,3,0,0,0,0,0,17,0,0,0,1,6,0,0,0,0,2,0,1,0,0,32,2,0,0,1,3,1,0,0,0,0,300,1,1,0,0,6,0,1,0,45,0,1,0,0,3,0,0,0,0,66,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,4,0,0,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
"healthy-OV-r4" : [ 895,0,0,3,5,8,0,0,13,3,0,0,0,2,82,0,91,0,1,0,113,110,4,0,2,1,22,0,0,0,11,0,0,31,9,0,0,0,0,0,13,0,0,1,0,13,0,0,0,0,0,0,0,0,0,22,1,0,0,1,1,0,0,0,1,0,350,1,3,0,0,10,0,1,0,76,0,0,1,0,4,0,1,0,0,28,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,2,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0],
"healthy-T-r1" : [ 553,9,0,40,4,14,111,6,2,216,0,0,0,1,55,2,21,3,0,0,65,69,0,0,14,0,94,0,5,1,8,8,4,10,5,0,3,0,0,3,8,1,7,0,0,10,0,0,0,0,0,0,5,0,0,17,2,0,0,2,6,2,0,1,3,0,3071,2,4,0,0,17,0,0,0,13,0,0,0,4,1,0,1,0,0,16,7,0,0,16,1,0,2,1,5,0,0,0,3,0,1,0,0,0,0,0,0,0,0,0,0,3,13,0,0,0,0,1,15,0,0,0,0,0,0,0,0,0,3,2,0,0,0,1,0,0,0,0,0,0,4,0,0,0,0,4,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,4,1,0,0,1,0,1,0,5,0,1,0,0,0,0,0,0,1,0,0,1,0,1,0,1,0,0,0,0,1,0,0],
"healthy-T-r2" : [ 412,0,1,9,6,7,1,0,6,104,0,0,0,3,88,0,39,0,1,0,165,64,1,0,0,1,75,0,1,0,8,1,0,33,10,0,0,0,0,0,20,0,0,1,0,10,0,0,1,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,1,686,2,8,0,0,7,0,0,0,41,0,0,0,0,2,0,0,0,1,14,1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,2,0,0,0,0,2,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]
}

sponge_mutations = { "dis-L-r1" : 1.058, "dis-L-r2" : 1.0388, "dis-L-r3" : 1.2808, "dis-OV-r2" : 0.6703, "dis-OV-r3" : 0.934, "dis-OV-r4" : 1.024, "dis-T-r1" : 0.8197, "dis-T-r2" : 1.0321, "dis-T-r4" : 1.077, "healthy-L-r2" : 1.153, "healthy-L-r3" : 1.098, "healthy-L-r4" : 1.203, "healthy-L-r5" : 1.197, "healthy-OV-r2" : 1.128, "healthy-OV-r3" : 	1.051, "healthy-OV-r4": 1.015, "healthy-T-r1" : 0.9066, "healthy-T-r2" : 1.116, "healthy-T-r3" : 1.215 }


fig, ax = plt.subplots( 1, 3, figsize=(20,10), dpi=80 )
tcolors = [ "#7a4747", "#6565ad" ]

def Gini( distr ):
	tsum = 0
	psum = 0
	n = len( distr )
	if n < 2:
		return 0.
	for i in range( n ):
		tsum += distr[i]
		psum += distr[i] * ( i + 1 )
	return 1. - 2. * ( float( n ) - float( psum ) / tsum ) / ( n - 1 )

def Shannon( distr ):
	rsum = 0
	n = len( distr )
	nsum = sum( distr )
	for i in range( n ):
		p = float( distr[i] ) / nsum
		rsum += p * math.log( p )
	return -rsum

def Simpson( distr ):
	ssum = 0
	n = len( distr )
	nsum = sum( distr )
	for i in range( n ):
		p = float( distr[i] ) 
		ssum += p * ( p - 1 )
	return 1 - ssum / ( nsum * ( nsum - 1 ) )


ax_l = ax[0]

locations = [ "L", "OV", "T" ]

samples = sponge_abund.keys()
indices = [ [], [] ]
xcoords = []
scolors = []
regression = [ [ [], [], [] ], [ [], [], [] ] ] 

for sn in range( len( samples ) ):
	sample = samples[sn]
	sloc = sample[ sample.find( "-" ) + 1 : ].split( "-" )[0]
	sitot = sorted( sponge_abund[ sample ], reverse = True )
	zind = sitot.index( 0 )
	si = sitot[ 0 : zind ]
	nsn = []
	nsi = []
	xnorm = float( len( si ) )
	ynorm = float( sum( si ) )
	ysum = 0
	ltype = 0 if sample[ : 3 ] == "dis" else 1
	for k in range( len( si ) ):
		ysum += si[ -( k + 1 ) ]
		nsn.append( k / xnorm )
		nsi.append( ysum / ynorm ) 
	dtype = 0 if sample[ : 3 ] == "dis" else 1
	ltype = locations.index( sloc )
	ax_l.plot( nsn, nsi, color=tcolors[ dtype ], lw=1.5, alpha = 0.8 )
	if sample not in sponge_mutations:
		continue
	cind = [ -Gini( si ),  sponge_mutations[ sample ] ]
	xcoord = ltype - 0.15 + 0.3 * dtype
	for inum in range( 2 ):
		indices[ inum ].append( cind[ inum ] )
		regression[ dtype ][ inum ].append( cind[ inum ]  )
	regression[ dtype ][ 2 ].append( xcoord  )
	xcoords.append( xcoord )
	scolors.append( tcolors[ dtype ] )
		
	#ax[k].text( 0.5, 1.01, slnames[k], ha='center', va= 'bottom', size=18 )
	#mplist = []
	#mplist.append( mpatches.Patch( color=tcolors[0], label=straitlabels[k][0] ) )
	#mplist.append( mpatches.Patch( color=tcolors[1], label=straitlabels[k][1] ) )
	#ax[k].legend(handles = mplist,loc='upper center')
	
ax_l.set_xticks( [ 0, 1 ] )
ax_l.set_xticklabels( [ "0", "100%" ], size = 18)
ax_l.set_yticks( [ 0.5 ] )
ax_l.set_yticklabels( [ "50" ], size = 18 )
ax_l.set_ylabel( u"Количество, %", size=21 )
ax_l.set_xlabel( u"Порядковый номер", size=21 )
ax_l.barh( [ 0.88, 0.96 ], [ 0.06, 0.06 ], height = 0.04, left = [ 0.03, 0.03 ], align = "edge", color = tcolors )
ax_l.text( 0.12, 0.884, u"Больные губки", ha="left", size = 21 )
ax_l.text( 0.12, 0.964, u"Здоровые губки", ha="left", size = 21 )
ax_l.set_title( u"кривые Лоренца", size=23 )
ititles = [ u"Джини", u"Шеннон", u"\"Больцман\"" ]
nlocations = [ u"Листвянка", u"Ольхон", u"мыс Турали" ]


ax_b = ax[ 1 ]
ax_b.scatter( xcoords, indices[ 1 ], color = scolors, s = 200, marker='+' )
ax_b.set_title( u"Адаптация по местоположению", size = 23 )
ax_b.set_xticks( [ 0, 1, 2 ] )
ax_b.set_xticklabels( nlocations, size = 21, rotation="vertical" )
ax_b.set_xlim( [ -0.75, 2.85 ] )
ax_b.tick_params( axis='y', labelsize = 18 )
ax_b.set_ylim( [ 0.5, 1.5 ] )
for dk in range( 2 ):
	( al,bl,rl,ttl,stderrl ) = stats.linregress( regression[ dk ][ 2 ], regression[ dk ][1] )
	xlim = [ min( regression[dk][2] ), max( regression[dk][2] ) ]
	ylim = [ bl + al * xlim[0], bl + al * xlim[1] ]
	ax_b.plot( xlim, ylim, c = tcolors[dk], lw = 1.2 )
	

ax_ad = ax[2]
ax_ad.scatter( indices[0], indices[1], color = scolors, s = 300, marker='+' )
ax_ad.set_ylim( [ 0.5, 1.5 ] )
ax_ad.set_xlim( [ 0.65, 1.05 ] )
ax_ad.tick_params( axis='y', labelsize = 18 )
ax_ad.tick_params( axis='x', labelsize = 18 )
ax_ad.set_title( u"Адаптация / Биоразнообразие", size = 23 )
#ax_ad.set_ylabel( u"\"Больцман\"", size=21 )
ax_ad.set_xlabel( u"индекс Джини", size=21 )
for dk in range( 2 ):
	( al,bl,rl,ttl,stderrl ) = stats.linregress( regression[ dk ][ 0 ], regression[ dk ][1] )
	xlim = [ min( regression[dk][0] ), max( regression[dk][0] ) ]
	ylim = [ bl + al * xlim[0], bl + al * xlim[1] ]
	ax_ad.plot( xlim, ylim, c = tcolors[dk], lw = 1.7 )


plt.tight_layout()
plt.savefig( "sponge_diversity.png" )

